'use strict';const _0x42ae00=_0x2dfc;(function(_0x5f1566,_0x457122){const _0xcb321c=_0x2dfc,_0x1aa1ce=_0x5f1566();while(!![]){try{const _0x155c26=parseInt(_0xcb321c(0xab))/0x1+parseInt(_0xcb321c(0xce))/0x2*(-parseInt(_0xcb321c(0xd7))/0x3)+-parseInt(_0xcb321c(0xe0))/0x4*(-parseInt(_0xcb321c(0xd6))/0x5)+parseInt(_0xcb321c(0xb9))/0x6*(parseInt(_0xcb321c(0x9b))/0x7)+-parseInt(_0xcb321c(0xf2))/0x8*(-parseInt(_0xcb321c(0xd9))/0x9)+parseInt(_0xcb321c(0xf3))/0xa+-parseInt(_0xcb321c(0x9d))/0xb*(parseInt(_0xcb321c(0xbf))/0xc);if(_0x155c26===_0x457122)break;else _0x1aa1ce['push'](_0x1aa1ce['shift']());}catch(_0x1513f0){_0x1aa1ce['push'](_0x1aa1ce['shift']());}}}(_0x3c24,0xc50a3));function _0x3c24(){const _0x8808dc=['slice','createMarketStream','shareFDA','stream','map','getPrice','isSameOrAfter','diffShares','shareHalts','haltTimeout','options','500106EohHvK','figi','defineProperty','market','now','INSTRUMENT_STATUS_BASE','71472BPUatk','foreignDiffShares','pipe','price','\x20запущен','Время\x20запроса\x20futures\x20в\x20reloadOptions:\x20','nearestHighIncrementValue','InstrumentStatus','next','DropShares','then','\x1b[36m%s\x1b[0m','add','day','foreignDiffSharesBuy','67596eoXdnj','instruments','wallet','\x1b[37m','Subject','tinkoff-invest-api/cjs/generated/instruments','share','shareReports','25GBEnLj','33tJunat','buy','207QslXBQ','Время\x20запроса\x20futures:\x20','sharesSettings','excludeByReports','subscribe','stoped','reloadOptions','490516lcJHiz','unavaliableShares','Helpers','allowTo','isSameOrBefore','diffSharesBuy','Параметры\x20Слеза:\x20обновлены','moment','push','excludeByFDA','maxMoneySize','stop','tinkoff-invest-api/cjs/generated/marketdata','halt','except','stream\x20closed,\x20reason:','setUnavaliableShares','log','546928wklTXh','12675070MKgRSj','ticker','excludeByExchange','shareDividends','moexDiffSharesBuy','__esModule','./drop.exclude-share','includeMS','excludeByDividends','api','startOf','includes','../utils/nearest-increment-value','unsubscribes','performance','includeReports','hours','find','buyTheDrop','excludeByList','error','processOnCandle','SubscriptionInterval','tap','toFixed','119IGclEw','exchange','9559NchaBC','forEach','length','rxjs','perf_hooks','futures','minutes','start','excludeByHealth','FORTS_EVENING','all','isArray','has','tinkoff-invest-api','1484580IGyMrm','toNumber','endOf'];_0x3c24=function(){return _0x8808dc;};return _0x3c24();}Object[_0x42ae00(0xbb)](exports,_0x42ae00(0xf8),{'value':!![]}),exports['DropShares']=void 0x0;const moment=require(_0x42ae00(0xe7)),rxjs_1=require(_0x42ae00(0xa0)),tinkoff_invest_api_1=require(_0x42ae00(0xaa)),instruments_1=require(_0x42ae00(0xd3)),marketdata_1=require(_0x42ae00(0xec)),nearest_increment_value_1=require(_0x42ae00(0xff)),drop_exclude_share_1=require(_0x42ae00(0xf9)),stratagies_names_1=require('./stratagies.names'),perf_hooks_1=require(_0x42ae00(0xa1)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x3c81bc,_0x2cfe87,_0x4b0fbd){const _0x5c0f82=_0x42ae00;this[_0x5c0f82(0xfc)]=_0x3c81bc,this[_0x5c0f82(0xd0)]=_0x4b0fbd,this['stoped']=![],this[_0x5c0f82(0xed)]=![],this[_0x5c0f82(0x100)]=[],this[_0x5c0f82(0x105)]=new rxjs_1[(_0x5c0f82(0xd2))](),this['unavaliableShares']=new Set(),this[_0x5c0f82(0xb8)]=_0x2cfe87,this['buyTheDrop'][_0x5c0f82(0xc1)]((0x0,rxjs_1['filter'])(()=>!this[_0x5c0f82(0xed)]),(0x0,rxjs_1['tap'])(()=>{const _0x2ad14b=_0x5c0f82;!this['halt']&&(this['halt']=!![],setTimeout(()=>this['halt']=![],this['options'][_0x2ad14b(0xb7)]));}),(0x0,rxjs_1[_0x5c0f82(0x10a)])(_0xc60236=>{const _0x369a3b=_0x5c0f82;this[_0x369a3b(0xd0)][_0x369a3b(0xd8)](_0xc60236[_0x369a3b(0xc2)],_0xc60236[_0x369a3b(0xd4)],stratagies_names_1['STRATAGIES_NAMES']['DROP']);}))['subscribe']();}async[_0x42ae00(0xa4)](_0x3cc882,_0x573eb6,_0x49d0bf,_0x535aee){const _0x3ced82=_0x42ae00;this['stoped']=![];const _0x576045=perf_hooks_1[_0x3ced82(0x101)][_0x3ced82(0xbd)](),_0x4e03f6=await this[_0x3ced82(0xfc)][_0x3ced82(0xcf)][_0x3ced82(0xa2)]({'instrumentStatus':instruments_1[_0x3ced82(0xc6)][_0x3ced82(0xbe)]}),_0x34cb67=perf_hooks_1[_0x3ced82(0x101)][_0x3ced82(0xbd)]();console['log'](_0x3ced82(0xda)+(_0x34cb67-_0x576045)[_0x3ced82(0x10b)](0x2)+'\x20мс'),(0x0,rxjs_1['combineLatest'])([_0x3cc882,_0x573eb6,_0x49d0bf,_0x535aee])[_0x3ced82(0xdd)](_0x5d4221=>{const _0x588ba5=_0x3ced82;this[_0x588ba5(0xf6)]=_0x5d4221[0x0],this[_0x588ba5(0xb0)]=_0x5d4221[0x1],this[_0x588ba5(0xb6)]=_0x5d4221[0x2],this[_0x588ba5(0xd5)]=_0x5d4221[0x3],this[_0x588ba5(0xf0)](_0x4e03f6[_0x588ba5(0xcf)]);});const _0xf09578=_0x4e03f6['instruments']['filter'](_0x304752=>_0x304752[_0x3ced82(0x9c)][_0x3ced82(0xfe)](_0x3ced82(0xa6))),_0x2bceba=[];for(let _0xb59bdf=0x0;_0xb59bdf<_0xf09578[_0x3ced82(0x9f)];_0xb59bdf+=CHANK_SIZE){_0x2bceba[_0x3ced82(0xe8)](_0xf09578[_0x3ced82(0xae)](_0xb59bdf,_0xb59bdf+CHANK_SIZE));}_0x2bceba[_0x3ced82(0x9e)]((_0x1733d4,_0x311c1e)=>{const _0x3c5612=_0x3ced82,_0x448174=this['api'][_0x3c5612(0xaf)]()['candles']({'instruments':_0x1733d4[_0x3c5612(0xb2)](_0x3732d9=>({'figi':_0x3732d9['figi'],'interval':marketdata_1[_0x3c5612(0x109)]['SUBSCRIPTION_INTERVAL_ONE_MINUTE']})),'waitingClose':![]},_0xef5a96=>this[_0x3c5612(0x108)](_0xef5a96,_0x1733d4));setTimeout(()=>{const _0x1a8762=_0x3c5612;(0x0,rxjs_1['from'])(_0x448174)[_0x1a8762(0xdd)](_0x382f8d=>{const _0x3b149e=_0x1a8762;!this[_0x3b149e(0xde)]?(console[_0x3b149e(0xf1)]('Чанк\x20'+_0x2bceba[_0x3b149e(0x9f)]+_0x3b149e(0xc3)),this[_0x3b149e(0x100)]['push'](_0x382f8d)):_0x382f8d();});},_0x311c1e*0x3e8);}),this[_0x3ced82(0xfc)][_0x3ced82(0xb1)][_0x3ced82(0xbc)]['on'](_0x3ced82(0x107),_0x507f3e=>console[_0x3ced82(0xf1)]('stream\x20error',_0x507f3e)),this[_0x3ced82(0xfc)][_0x3ced82(0xb1)][_0x3ced82(0xbc)]['on']('close',_0x1ac224=>console['log'](_0x3ced82(0xef),_0x1ac224));}[_0x42ae00(0xeb)](){const _0x125be7=_0x42ae00;Promise[_0x125be7(0xa7)](this[_0x125be7(0x100)])['then'](),this[_0x125be7(0xde)]=!![];}['setUnavaliableShares'](_0x5eaa03){const _0x19fdcd=_0x42ae00;this[_0x19fdcd(0xe1)]=new Set(),_0x5eaa03[_0x19fdcd(0x9e)](_0x3dcdf7=>{const _0x75c2d0=_0x19fdcd;(0x0,drop_exclude_share_1[_0x75c2d0(0x106)])(_0x3dcdf7,this[_0x75c2d0(0xb8)][_0x75c2d0(0xee)])&&this[_0x75c2d0(0xe1)]['add'](_0x3dcdf7[_0x75c2d0(0xf4)]);if((0x0,drop_exclude_share_1[_0x75c2d0(0xf5)])(_0x3dcdf7,this['options']))this[_0x75c2d0(0xe1)][_0x75c2d0(0xcb)](_0x3dcdf7['ticker']);if(!_0x3dcdf7[_0x75c2d0(0x9c)][_0x75c2d0(0xfe)](_0x75c2d0(0xa6))){if((0x0,drop_exclude_share_1[_0x75c2d0(0xa5)])(_0x3dcdf7,this['options']))this['unavaliableShares']['add'](_0x3dcdf7[_0x75c2d0(0xf4)]);if((0x0,drop_exclude_share_1[_0x75c2d0(0xe9)])(_0x3dcdf7,this[_0x75c2d0(0xb0)]))this[_0x75c2d0(0xe1)][_0x75c2d0(0xcb)](_0x3dcdf7[_0x75c2d0(0xf4)]);if(!this[_0x75c2d0(0xb8)][_0x75c2d0(0x102)]&&(0x0,drop_exclude_share_1[_0x75c2d0(0xdc)])(_0x3dcdf7,this['shareReports']))this[_0x75c2d0(0xe1)][_0x75c2d0(0xcb)](_0x3dcdf7[_0x75c2d0(0xf4)]);if((0x0,drop_exclude_share_1['excludeByHalts'])(_0x3dcdf7,this[_0x75c2d0(0xb6)]))this['unavaliableShares'][_0x75c2d0(0xcb)](_0x3dcdf7[_0x75c2d0(0xf4)]);if((0x0,drop_exclude_share_1[_0x75c2d0(0xfb)])(_0x3dcdf7,this[_0x75c2d0(0xf6)]))this[_0x75c2d0(0xe1)][_0x75c2d0(0xcb)](_0x3dcdf7[_0x75c2d0(0xf4)]);const _0x4b39bf=moment(),_0x575707=moment()[_0x75c2d0(0xfd)](_0x75c2d0(0xcc))[_0x75c2d0(0xcb)](0x11,_0x75c2d0(0x103))['add'](0x19,_0x75c2d0(0xa3)),_0x42409f=moment()[_0x75c2d0(0xad)](_0x75c2d0(0xcc));_0x4b39bf['isSameOrAfter'](_0x575707)&&_0x4b39bf[_0x75c2d0(0xe4)](_0x42409f)&&!this[_0x75c2d0(0xb8)][_0x75c2d0(0xfa)]&&this['unavaliableShares']['add'](_0x3dcdf7[_0x75c2d0(0xf4)]),_0x4b39bf[_0x75c2d0(0xe4)](_0x575707)&&_0x4b39bf[_0x75c2d0(0xb4)](_0x42409f)&&this['unavaliableShares'][_0x75c2d0(0xcb)](_0x3dcdf7[_0x75c2d0(0xf4)]);}});}[_0x42ae00(0xe3)](_0x21aef5){const _0x3be8d6=_0x42ae00;if(this['unavaliableShares'][_0x3be8d6(0xa9)](_0x21aef5['ticker']))return![];return!![];}[_0x42ae00(0x108)](_0x5527bb,_0x23330b){const _0x312089=_0x42ae00;var _0x444d99;const _0xe20325=_0x23330b[_0x312089(0x104)](_0x8b834c=>_0x8b834c[_0x312089(0xba)]===_0x5527bb[_0x312089(0xba)]);if(this[_0x312089(0xe3)](_0xe20325)){const {open:_0x5e14b6,low:_0xa4f2c4}=_0x5527bb,_0x577ec5=tinkoff_invest_api_1['Helpers'][_0x312089(0xac)](_0xa4f2c4),_0x2ea32d=tinkoff_invest_api_1['Helpers'][_0x312089(0xac)](_0x5e14b6),_0x4a3e2a=Array[_0x312089(0xa8)]((_0x444d99=this[_0x312089(0xb8)])===null||_0x444d99===void 0x0?void 0x0:_0x444d99[_0x312089(0xdb)])&&this['options']['sharesSettings'][_0x312089(0x104)](_0x43a458=>_0x43a458[_0x312089(0xba)]===_0xe20325[_0x312089(0xba)]);_0xe20325[_0x312089(0x9c)][_0x312089(0xfe)](_0x312089(0xa6))?_0x2ea32d*((_0x4a3e2a===null||_0x4a3e2a===void 0x0?void 0x0:_0x4a3e2a[_0x312089(0xb5)])||this[_0x312089(0xb8)]['moexDiffShares'])>=_0x577ec5&&this[_0x312089(0x105)][_0x312089(0xc7)]({'price':this[_0x312089(0xb3)](_0x577ec5,_0x2ea32d-_0x577ec5,_0xe20325,_0x4a3e2a),'share':_0xe20325,'money':_0x4a3e2a===null||_0x4a3e2a===void 0x0?void 0x0:_0x4a3e2a[_0x312089(0xea)]}):_0x2ea32d*((_0x4a3e2a===null||_0x4a3e2a===void 0x0?void 0x0:_0x4a3e2a[_0x312089(0xb5)])||this[_0x312089(0xb8)][_0x312089(0xc0)])>=_0x577ec5&&_0x577ec5>0x5&&this[_0x312089(0x105)][_0x312089(0xc7)]({'price':this[_0x312089(0xb3)](_0x577ec5,_0x2ea32d-_0x577ec5,_0xe20325,_0x4a3e2a),'share':_0xe20325,'money':_0x4a3e2a===null||_0x4a3e2a===void 0x0?void 0x0:_0x4a3e2a[_0x312089(0xea)]});}}['getPrice'](_0x9d7af9,_0x18a252,_0x370abc,_0x1b1221){const _0x4adf72=_0x42ae00,_0x35a5e3=tinkoff_invest_api_1[_0x4adf72(0xe2)][_0x4adf72(0xac)](_0x370abc['minPriceIncrement']);if(_0x370abc['exchange'][_0x4adf72(0xfe)]('FORTS_EVENING'))return(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x9d7af9+_0x18a252*((_0x1b1221===null||_0x1b1221===void 0x0?void 0x0:_0x1b1221[_0x4adf72(0xe5)])||this[_0x4adf72(0xb8)][_0x4adf72(0xf7)]),_0x35a5e3);return _0x9d7af9<0x5?(0x0,nearest_increment_value_1[_0x4adf72(0xc5)])(_0x9d7af9+_0x35a5e3,_0x35a5e3):(0x0,nearest_increment_value_1[_0x4adf72(0xc5)])(_0x9d7af9+_0x18a252*((_0x1b1221===null||_0x1b1221===void 0x0?void 0x0:_0x1b1221[_0x4adf72(0xe5)])||this[_0x4adf72(0xb8)][_0x4adf72(0xcd)]),_0x35a5e3);}[_0x42ae00(0xdf)](_0x43c02c){const _0x41f6b4=_0x42ae00;this[_0x41f6b4(0xb8)]=_0x43c02c;const _0x1e2d37=perf_hooks_1[_0x41f6b4(0x101)]['now']();this['api'][_0x41f6b4(0xcf)][_0x41f6b4(0xa2)]({'instrumentStatus':instruments_1['InstrumentStatus'][_0x41f6b4(0xbe)]})[_0x41f6b4(0xc9)](_0x253ed0=>{const _0x14a65a=_0x41f6b4,_0x27880a=perf_hooks_1['performance']['now']();console[_0x14a65a(0xf1)](_0x14a65a(0xc4)+(_0x27880a-_0x1e2d37)[_0x14a65a(0x10b)](0x2)+'\x20мс'),console[_0x14a65a(0xf1)](_0x14a65a(0xca),_0x14a65a(0xe6),_0x14a65a(0xd1)),this['setUnavaliableShares'](_0x253ed0[_0x14a65a(0xcf)]);});}}function _0x2dfc(_0x53eee9,_0x5d5381){const _0x3c24b9=_0x3c24();return _0x2dfc=function(_0x2dfc86,_0x26010e){_0x2dfc86=_0x2dfc86-0x9b;let _0x2a0dcd=_0x3c24b9[_0x2dfc86];return _0x2a0dcd;},_0x2dfc(_0x53eee9,_0x5d5381);}exports[_0x42ae00(0xc8)]=DropShares;