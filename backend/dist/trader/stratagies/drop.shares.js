'use strict';const _0x146a77=_0x5f35;(function(_0x5a537b,_0x26eb4f){const _0x4fad96=_0x5f35,_0x34052e=_0x5a537b();while(!![]){try{const _0x357b1b=-parseInt(_0x4fad96(0x15f))/0x1+-parseInt(_0x4fad96(0x135))/0x2+-parseInt(_0x4fad96(0x14d))/0x3+parseInt(_0x4fad96(0x16e))/0x4*(parseInt(_0x4fad96(0x134))/0x5)+-parseInt(_0x4fad96(0x144))/0x6+-parseInt(_0x4fad96(0x13d))/0x7*(-parseInt(_0x4fad96(0x153))/0x8)+parseInt(_0x4fad96(0x18a))/0x9;if(_0x357b1b===_0x26eb4f)break;else _0x34052e['push'](_0x34052e['shift']());}catch(_0x34e763){_0x34052e['push'](_0x34052e['shift']());}}}(_0x5457,0xdcaf7));Object['defineProperty'](exports,_0x146a77(0x162),{'value':!![]}),exports[_0x146a77(0x15e)]=void 0x0;const moment=require('moment'),rxjs_1=require(_0x146a77(0x169)),tinkoff_invest_api_1=require(_0x146a77(0x190)),instruments_1=require('tinkoff-invest-api/cjs/generated/instruments'),marketdata_1=require(_0x146a77(0x17d)),nearest_increment_value_1=require(_0x146a77(0x18c)),drop_exclude_share_1=require(_0x146a77(0x178)),stratagies_names_1=require(_0x146a77(0x15c)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x58915c,_0x58bbea,_0x536292){const _0x7c0ef7=_0x146a77;this[_0x7c0ef7(0x158)]=_0x58915c,this['wallet']=_0x536292,this[_0x7c0ef7(0x152)]=![],this[_0x7c0ef7(0x16b)]=![],this['unsubscribes']=[],this[_0x7c0ef7(0x17a)]=new rxjs_1[(_0x7c0ef7(0x189))](),this[_0x7c0ef7(0x147)]=new Set(),this[_0x7c0ef7(0x161)]=_0x58bbea,this[_0x7c0ef7(0x17a)]['pipe']((0x0,rxjs_1[_0x7c0ef7(0x15b)])(()=>!this[_0x7c0ef7(0x16b)]),(0x0,rxjs_1[_0x7c0ef7(0x132)])(()=>{const _0x2c1ea9=_0x7c0ef7;!this[_0x2c1ea9(0x16b)]&&(this[_0x2c1ea9(0x16b)]=!![],setTimeout(()=>this[_0x2c1ea9(0x16b)]=![],this['options'][_0x2c1ea9(0x185)]));}),(0x0,rxjs_1[_0x7c0ef7(0x132)])(_0x63581f=>{const _0x2f54fc=_0x7c0ef7;this[_0x2f54fc(0x13a)][_0x2f54fc(0x196)](_0x63581f['price'],_0x63581f[_0x2f54fc(0x16c)],stratagies_names_1[_0x2f54fc(0x192)][_0x2f54fc(0x179)]);}))['subscribe']();}async['start'](_0x43833b,_0xa02b66,_0x4e13c3,_0x253ce1){const _0x22d04f=_0x146a77;this[_0x22d04f(0x152)]=![];const _0x5625a0=await this[_0x22d04f(0x158)]['instruments'][_0x22d04f(0x13c)]({'instrumentStatus':instruments_1[_0x22d04f(0x17c)][_0x22d04f(0x197)]});(0x0,rxjs_1[_0x22d04f(0x141)])([_0x43833b,_0xa02b66,_0x4e13c3,_0x253ce1])['subscribe'](_0x7c02d4=>{const _0x112e45=_0x22d04f;this[_0x112e45(0x166)]=_0x7c02d4[0x0],this[_0x112e45(0x146)]=_0x7c02d4[0x1],this[_0x112e45(0x18b)]=_0x7c02d4[0x2],this[_0x112e45(0x173)]=_0x7c02d4[0x3],this['setUnavaliableShares'](_0x5625a0[_0x112e45(0x14a)]);});const _0xfdfb9e=_0x5625a0[_0x22d04f(0x14a)][_0x22d04f(0x15b)](_0x1ebff4=>_0x1ebff4['exchange'][_0x22d04f(0x136)]('FORTS_EVENING')),_0x43cda0=[];for(let _0x44b797=0x0;_0x44b797<_0xfdfb9e[_0x22d04f(0x14c)];_0x44b797+=CHANK_SIZE){_0x43cda0[_0x22d04f(0x17b)](_0xfdfb9e[_0x22d04f(0x16f)](_0x44b797,_0x44b797+CHANK_SIZE));}_0x43cda0[_0x22d04f(0x17f)]((_0x31e268,_0x4bebfd)=>{const _0x371ab1=_0x22d04f,_0x54c48c=this[_0x371ab1(0x158)][_0x371ab1(0x145)]()[_0x371ab1(0x14e)]({'instruments':_0x31e268[_0x371ab1(0x157)](_0x555a33=>({'figi':_0x555a33[_0x371ab1(0x187)],'interval':marketdata_1[_0x371ab1(0x182)][_0x371ab1(0x18f)]})),'waitingClose':![]},_0x14b040=>this[_0x371ab1(0x193)](_0x14b040,_0x31e268));setTimeout(()=>{const _0x3fbbf6=_0x371ab1;(0x0,rxjs_1[_0x3fbbf6(0x186)])(_0x54c48c)[_0x3fbbf6(0x194)](_0x5d9487=>{const _0x3c7958=_0x3fbbf6;!this[_0x3c7958(0x152)]?(console[_0x3c7958(0x176)]('Чанк\x20'+_0x43cda0[_0x3c7958(0x14c)]+_0x3c7958(0x137)),this[_0x3c7958(0x142)]['push'](_0x5d9487)):_0x5d9487();});},_0x4bebfd*0x3e8);}),this['api'][_0x22d04f(0x164)]['market']['on'](_0x22d04f(0x14f),_0x33b92b=>console['log'](_0x22d04f(0x14b),_0x33b92b)),this[_0x22d04f(0x158)]['stream']['market']['on'](_0x22d04f(0x17e),_0xd64dc8=>console[_0x22d04f(0x176)](_0x22d04f(0x148),_0xd64dc8));}[_0x146a77(0x156)](){const _0x1d0c50=_0x146a77;Promise['all'](this[_0x1d0c50(0x142)])[_0x1d0c50(0x155)](),this[_0x1d0c50(0x152)]=!![];}[_0x146a77(0x177)](_0x437ba6){const _0x1a7ce3=_0x146a77;this[_0x1a7ce3(0x147)]=new Set(),_0x437ba6[_0x1a7ce3(0x17f)](_0x3fc6c9=>{const _0x260833=_0x1a7ce3;(0x0,drop_exclude_share_1[_0x260833(0x181)])(_0x3fc6c9,this[_0x260833(0x161)][_0x260833(0x159)])&&this['unavaliableShares']['add'](_0x3fc6c9[_0x260833(0x184)]);if((0x0,drop_exclude_share_1[_0x260833(0x180)])(_0x3fc6c9,this['options']))this['unavaliableShares'][_0x260833(0x188)](_0x3fc6c9[_0x260833(0x184)]);if(!_0x3fc6c9[_0x260833(0x18e)][_0x260833(0x136)](_0x260833(0x140))){if((0x0,drop_exclude_share_1[_0x260833(0x13b)])(_0x3fc6c9,this[_0x260833(0x161)]))this[_0x260833(0x147)][_0x260833(0x188)](_0x3fc6c9['ticker']);if((0x0,drop_exclude_share_1['excludeByFDA'])(_0x3fc6c9,this[_0x260833(0x146)]))this[_0x260833(0x147)]['add'](_0x3fc6c9[_0x260833(0x184)]);if(!this['options'][_0x260833(0x143)]&&(0x0,drop_exclude_share_1['excludeByReports'])(_0x3fc6c9,this[_0x260833(0x173)]))this[_0x260833(0x147)][_0x260833(0x188)](_0x3fc6c9[_0x260833(0x184)]);if((0x0,drop_exclude_share_1[_0x260833(0x171)])(_0x3fc6c9,this[_0x260833(0x18b)]))this[_0x260833(0x147)]['add'](_0x3fc6c9[_0x260833(0x184)]);if((0x0,drop_exclude_share_1['excludeByDividends'])(_0x3fc6c9,this[_0x260833(0x166)]))this[_0x260833(0x147)]['add'](_0x3fc6c9['ticker']);const _0x4253c0=moment(),_0x3fbb8a=moment()[_0x260833(0x170)](_0x260833(0x168))[_0x260833(0x188)](0x11,_0x260833(0x163))[_0x260833(0x188)](0x19,_0x260833(0x13f)),_0x3c7a43=moment()['endOf'](_0x260833(0x168));_0x4253c0[_0x260833(0x167)](_0x3fbb8a)&&_0x4253c0[_0x260833(0x150)](_0x3c7a43)&&!this['options']['includeMS']&&this[_0x260833(0x147)]['add'](_0x3fc6c9[_0x260833(0x184)]),_0x4253c0[_0x260833(0x150)](_0x3fbb8a)&&_0x4253c0[_0x260833(0x167)](_0x3c7a43)&&this[_0x260833(0x147)][_0x260833(0x188)](_0x3fc6c9[_0x260833(0x184)]);}});}[_0x146a77(0x172)](_0x68f8a3){const _0x1b939b=_0x146a77;if(this[_0x1b939b(0x147)]['has'](_0x68f8a3[_0x1b939b(0x184)]))return![];return!![];}[_0x146a77(0x193)](_0x528e9d,_0x2252a0){const _0x3b990e=_0x146a77;var _0x5b093c;const _0x7533d9=_0x2252a0[_0x3b990e(0x160)](_0xd31c3a=>_0xd31c3a[_0x3b990e(0x187)]===_0x528e9d[_0x3b990e(0x187)]);if(this[_0x3b990e(0x172)](_0x7533d9)){const {open:_0xe5f860,low:_0x1e2a59}=_0x528e9d,_0x6b8988=tinkoff_invest_api_1['Helpers'][_0x3b990e(0x174)](_0x1e2a59),_0x2af7fd=tinkoff_invest_api_1[_0x3b990e(0x151)][_0x3b990e(0x174)](_0xe5f860),_0x304c3d=Array['isArray']((_0x5b093c=this[_0x3b990e(0x161)])===null||_0x5b093c===void 0x0?void 0x0:_0x5b093c[_0x3b990e(0x165)])&&this[_0x3b990e(0x161)]['sharesSettings']['find'](_0x5a1ecf=>_0x5a1ecf[_0x3b990e(0x187)]===_0x7533d9[_0x3b990e(0x187)]);_0x7533d9[_0x3b990e(0x18e)]['includes'](_0x3b990e(0x140))?_0x2af7fd*((_0x304c3d===null||_0x304c3d===void 0x0?void 0x0:_0x304c3d[_0x3b990e(0x15d)])||this['options'][_0x3b990e(0x133)])>=_0x6b8988&&this[_0x3b990e(0x17a)]['next']({'price':this[_0x3b990e(0x139)](_0x6b8988,_0x2af7fd-_0x6b8988,_0x7533d9,_0x304c3d),'share':_0x7533d9,'money':_0x304c3d===null||_0x304c3d===void 0x0?void 0x0:_0x304c3d['maxMoneySize']}):_0x2af7fd*((_0x304c3d===null||_0x304c3d===void 0x0?void 0x0:_0x304c3d[_0x3b990e(0x15d)])||this['options'][_0x3b990e(0x195)])>=_0x6b8988&&_0x6b8988>0x5&&this['buyTheDrop'][_0x3b990e(0x18d)]({'price':this[_0x3b990e(0x139)](_0x6b8988,_0x2af7fd-_0x6b8988,_0x7533d9,_0x304c3d),'share':_0x7533d9,'money':_0x304c3d===null||_0x304c3d===void 0x0?void 0x0:_0x304c3d[_0x3b990e(0x15a)]});}}[_0x146a77(0x139)](_0x12f0dd,_0x1cfee0,_0xdac7bd,_0x121273){const _0x319570=_0x146a77,_0x1c3d06=tinkoff_invest_api_1[_0x319570(0x151)][_0x319570(0x174)](_0xdac7bd[_0x319570(0x175)]);if(_0xdac7bd['exchange']['includes'](_0x319570(0x140)))return(0x0,nearest_increment_value_1[_0x319570(0x16a)])(_0x12f0dd+_0x1cfee0*((_0x121273===null||_0x121273===void 0x0?void 0x0:_0x121273[_0x319570(0x183)])||this[_0x319570(0x161)][_0x319570(0x13e)]),_0x1c3d06);return _0x12f0dd<0x5?(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x12f0dd+_0x1c3d06,_0x1c3d06):(0x0,nearest_increment_value_1[_0x319570(0x16a)])(_0x12f0dd+_0x1cfee0*((_0x121273===null||_0x121273===void 0x0?void 0x0:_0x121273[_0x319570(0x183)])||this[_0x319570(0x161)][_0x319570(0x16d)]),_0x1c3d06);}[_0x146a77(0x154)](_0x2c39ce){const _0x44fe29=_0x146a77;this[_0x44fe29(0x161)]=_0x2c39ce,this[_0x44fe29(0x158)][_0x44fe29(0x14a)][_0x44fe29(0x13c)]({'instrumentStatus':instruments_1[_0x44fe29(0x17c)][_0x44fe29(0x197)]})[_0x44fe29(0x155)](_0x10ca9c=>{const _0x4d5d72=_0x44fe29;console[_0x4d5d72(0x176)](_0x4d5d72(0x149),_0x4d5d72(0x191),_0x4d5d72(0x138)),this['setUnavaliableShares'](_0x10ca9c[_0x4d5d72(0x14a)]);});}}function _0x5457(){const _0xb0a621=['minPriceIncrement','log','setUnavaliableShares','./drop.exclude-share','DROP','buyTheDrop','push','InstrumentStatus','tinkoff-invest-api/cjs/generated/marketdata','close','forEach','excludeByExchange','excludeByList','SubscriptionInterval','diffSharesBuy','ticker','haltTimeout','from','figi','add','Subject','46155024sICLxa','shareHalts','../utils/nearest-increment-value','next','exchange','SUBSCRIPTION_INTERVAL_ONE_MINUTE','tinkoff-invest-api','Параметры\x20Слеза:\x20обновлены','STRATAGIES_NAMES','processOnCandle','subscribe','foreignDiffShares','buy','INSTRUMENT_STATUS_BASE','tap','moexDiffShares','70PGNjGH','3105674EnXmhX','includes','\x20запущен','\x1b[37m','getPrice','wallet','excludeByHealth','futures','119zhLval','moexDiffSharesBuy','minutes','FORTS_EVENING','combineLatest','unsubscribes','includeReports','3834960oVJeMT','createMarketStream','shareFDA','unavaliableShares','stream\x20closed,\x20reason:','\x1b[36m%s\x1b[0m','instruments','stream\x20error','length','3765378rWSnFV','candles','error','isSameOrBefore','Helpers','stoped','278864OvSKGT','reloadOptions','then','stop','map','api','except','maxMoneySize','filter','./stratagies.names','diffShares','DropShares','1579424AJGxVJ','find','options','__esModule','hours','stream','sharesSettings','shareDividends','isSameOrAfter','day','rxjs','nearestHighIncrementValue','halt','share','foreignDiffSharesBuy','59872vVEEpr','slice','startOf','excludeByHalts','allowTo','shareReports','toNumber'];_0x5457=function(){return _0xb0a621;};return _0x5457();}function _0x5f35(_0x5196ea,_0x5ed4c6){const _0x545706=_0x5457();return _0x5f35=function(_0x5f35e4,_0x32feee){_0x5f35e4=_0x5f35e4-0x132;let _0x1974ec=_0x545706[_0x5f35e4];return _0x1974ec;},_0x5f35(_0x5196ea,_0x5ed4c6);}exports['DropShares']=DropShares;