'use strict';function _0x14b3(){const _0x2e21aa=['excludeByFDA','isSameOrBefore','includeReports','haltTimeout','3397955PpARFI','getPrice','\x20запущен','error','4749717oiyrFs','InstrumentStatus','shareHalts','./drop.exclude-share','unavaliableShares','moexDiffSharesBuy','endOf','defineProperty','Чанк\x20','stoped','close','now','sharesSettings','forEach','excludeByDividends','figi','FORTS_EVENING','INSTRUMENT_STATUS_BASE','reloadOptions','foreignDiffSharesBuy','DROP','map','slice','diffShares','combineLatest','SUBSCRIPTION_INTERVAL_ONE_MINUTE','tinkoff-invest-api/cjs/generated/instruments','\x20мс','9vDImPh','minPriceIncrement','stop','allowTo','add','share','market','day','stream\x20error','subscribe','Subject','performance','diffSharesBuy','rxjs','__esModule','maxMoneySize','shareFDA','api','excludeByHalts','candles','ticker','Параметры\x20Слеза:\x20обновлены','../utils/nearest-increment-value','5826ujMReH','setUnavaliableShares','from','buyTheDrop','tap','376036EjtZmq','find','filter','\x1b[37m','log','has','buy','minutes','stream','isSameOrAfter','446074aVMDYR','excludeByList','5400588jQKRNL','toNumber','options','excludeByExchange','\x1b[36m%s\x1b[0m','halt','startOf','hours','then','toFixed','tinkoff-invest-api/cjs/generated/marketdata','unsubscribes','nearestHighIncrementValue','includes','wallet','STRATAGIES_NAMES','futures','perf_hooks','DropShares','instruments','processOnCandle','moment','shareDividends','580ZyhTOu','Helpers','exchange','next','16983664CzIHZx','moexDiffShares','shareReports'];_0x14b3=function(){return _0x2e21aa;};return _0x14b3();}const _0x2ea557=_0x5b65;(function(_0x11b116,_0x202c16){const _0x5739e5=_0x5b65,_0x5e78bf=_0x11b116();while(!![]){try{const _0x4967e6=parseInt(_0x5739e5(0x1d9))/0x1+parseInt(_0x5739e5(0x1cf))/0x2+parseInt(_0x5739e5(0x1ca))/0x3*(-parseInt(_0x5739e5(0x1f2))/0x4)+parseInt(_0x5739e5(0x1fd))/0x5+parseInt(_0x5739e5(0x1db))/0x6+parseInt(_0x5739e5(0x201))/0x7+parseInt(_0x5739e5(0x1f6))/0x8*(-parseInt(_0x5739e5(0x1b3))/0x9);if(_0x4967e6===_0x202c16)break;else _0x5e78bf['push'](_0x5e78bf['shift']());}catch(_0xef0e6d){_0x5e78bf['push'](_0x5e78bf['shift']());}}}(_0x14b3,0x77154));Object[_0x2ea557(0x208)](exports,_0x2ea557(0x1c1),{'value':!![]}),exports[_0x2ea557(0x1ed)]=void 0x0;function _0x5b65(_0xb66165,_0x4982c3){const _0x14b38e=_0x14b3();return _0x5b65=function(_0x5b65c6,_0xf4b594){_0x5b65c6=_0x5b65c6-0x1a8;let _0x2b6d20=_0x14b38e[_0x5b65c6];return _0x2b6d20;},_0x5b65(_0xb66165,_0x4982c3);}const moment=require(_0x2ea557(0x1f0)),rxjs_1=require(_0x2ea557(0x1c0)),tinkoff_invest_api_1=require('tinkoff-invest-api'),instruments_1=require(_0x2ea557(0x1b1)),marketdata_1=require(_0x2ea557(0x1e5)),nearest_increment_value_1=require(_0x2ea557(0x1c9)),drop_exclude_share_1=require(_0x2ea557(0x204)),stratagies_names_1=require('./stratagies.names'),perf_hooks_1=require(_0x2ea557(0x1ec)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x2ab5d3,_0x251355,_0x2405c8){const _0x50cd27=_0x2ea557;this[_0x50cd27(0x1c4)]=_0x2ab5d3,this[_0x50cd27(0x1e9)]=_0x2405c8,this[_0x50cd27(0x20a)]=![],this['halt']=![],this[_0x50cd27(0x1e6)]=[],this[_0x50cd27(0x1cd)]=new rxjs_1[(_0x50cd27(0x1bd))](),this[_0x50cd27(0x205)]=new Set(),this[_0x50cd27(0x1dd)]=_0x251355,this['buyTheDrop']['pipe']((0x0,rxjs_1['filter'])(()=>!this[_0x50cd27(0x1e0)]),(0x0,rxjs_1[_0x50cd27(0x1ce)])(()=>{const _0x3d1d5c=_0x50cd27;!this[_0x3d1d5c(0x1e0)]&&(this[_0x3d1d5c(0x1e0)]=!![],setTimeout(()=>this[_0x3d1d5c(0x1e0)]=![],this[_0x3d1d5c(0x1dd)][_0x3d1d5c(0x1fc)]));}),(0x0,rxjs_1['tap'])(_0x8a83a9=>{const _0x98ccec=_0x50cd27;this[_0x98ccec(0x1e9)][_0x98ccec(0x1d5)](_0x8a83a9['price'],_0x8a83a9[_0x98ccec(0x1b8)],stratagies_names_1[_0x98ccec(0x1ea)][_0x98ccec(0x1ab)]);}))[_0x50cd27(0x1bc)]();}async['start'](_0x51b936,_0x32d7bd,_0xda1ac6,_0x4b558f){const _0x47a714=_0x2ea557;this['stoped']=![];const _0x3784ce=perf_hooks_1[_0x47a714(0x1be)][_0x47a714(0x20c)](),_0x437669=await this[_0x47a714(0x1c4)][_0x47a714(0x1ee)]['futures']({'instrumentStatus':instruments_1[_0x47a714(0x202)][_0x47a714(0x1a8)]}),_0x1ae63a=perf_hooks_1['performance'][_0x47a714(0x20c)]();console[_0x47a714(0x1d3)]('Время\x20запроса\x20futures:\x20'+(_0x1ae63a-_0x3784ce)[_0x47a714(0x1e4)](0x2)+_0x47a714(0x1b2)),(0x0,rxjs_1[_0x47a714(0x1af)])([_0x51b936,_0x32d7bd,_0xda1ac6,_0x4b558f])[_0x47a714(0x1bc)](_0x540a2c=>{const _0x3314ca=_0x47a714;this[_0x3314ca(0x1f1)]=_0x540a2c[0x0],this[_0x3314ca(0x1c3)]=_0x540a2c[0x1],this['shareHalts']=_0x540a2c[0x2],this[_0x3314ca(0x1f8)]=_0x540a2c[0x3],this[_0x3314ca(0x1cb)](_0x437669['instruments']);});const _0x37c5bd=_0x437669[_0x47a714(0x1ee)][_0x47a714(0x1d1)](_0x13aea7=>_0x13aea7[_0x47a714(0x1f4)][_0x47a714(0x1e8)]('FORTS_EVENING')),_0xf345a1=[];for(let _0x3e7eec=0x0;_0x3e7eec<_0x37c5bd['length'];_0x3e7eec+=CHANK_SIZE){_0xf345a1['push'](_0x37c5bd[_0x47a714(0x1ad)](_0x3e7eec,_0x3e7eec+CHANK_SIZE));}_0xf345a1[_0x47a714(0x20e)]((_0x3fc7ee,_0xfd6049)=>{const _0x27e97d=_0x47a714,_0x149073=this[_0x27e97d(0x1c4)]['createMarketStream']()[_0x27e97d(0x1c6)]({'instruments':_0x3fc7ee[_0x27e97d(0x1ac)](_0x57f578=>({'figi':_0x57f578[_0x27e97d(0x210)],'interval':marketdata_1['SubscriptionInterval'][_0x27e97d(0x1b0)]})),'waitingClose':![]},_0x98f2e7=>this['processOnCandle'](_0x98f2e7,_0x3fc7ee));setTimeout(()=>{const _0x38891a=_0x27e97d;(0x0,rxjs_1[_0x38891a(0x1cc)])(_0x149073)[_0x38891a(0x1bc)](_0x45afbb=>{const _0x44f51a=_0x38891a;!this[_0x44f51a(0x20a)]?(console['log'](_0x44f51a(0x209)+_0xf345a1['length']+_0x44f51a(0x1ff)),this[_0x44f51a(0x1e6)]['push'](_0x45afbb)):_0x45afbb();});},_0xfd6049*0x3e8);}),this[_0x47a714(0x1c4)][_0x47a714(0x1d7)][_0x47a714(0x1b9)]['on'](_0x47a714(0x200),_0x3a1a29=>console['log'](_0x47a714(0x1bb),_0x3a1a29)),this['api'][_0x47a714(0x1d7)][_0x47a714(0x1b9)]['on'](_0x47a714(0x20b),_0x37f204=>console[_0x47a714(0x1d3)]('stream\x20closed,\x20reason:',_0x37f204));}[_0x2ea557(0x1b5)](){const _0x1de40e=_0x2ea557;Promise['all'](this[_0x1de40e(0x1e6)])[_0x1de40e(0x1e3)](),this[_0x1de40e(0x20a)]=!![];}[_0x2ea557(0x1cb)](_0x17f56f){const _0x4d214f=_0x2ea557;this[_0x4d214f(0x205)]=new Set(),_0x17f56f[_0x4d214f(0x20e)](_0x639b3a=>{const _0x55b35b=_0x4d214f;(0x0,drop_exclude_share_1[_0x55b35b(0x1da)])(_0x639b3a,this[_0x55b35b(0x1dd)]['except'])&&this[_0x55b35b(0x205)][_0x55b35b(0x1b7)](_0x639b3a[_0x55b35b(0x1c7)]);if((0x0,drop_exclude_share_1[_0x55b35b(0x1de)])(_0x639b3a,this[_0x55b35b(0x1dd)]))this[_0x55b35b(0x205)][_0x55b35b(0x1b7)](_0x639b3a['ticker']);if(!_0x639b3a[_0x55b35b(0x1f4)]['includes']('FORTS_EVENING')){if((0x0,drop_exclude_share_1['excludeByHealth'])(_0x639b3a,this[_0x55b35b(0x1dd)]))this[_0x55b35b(0x205)][_0x55b35b(0x1b7)](_0x639b3a[_0x55b35b(0x1c7)]);if((0x0,drop_exclude_share_1[_0x55b35b(0x1f9)])(_0x639b3a,this[_0x55b35b(0x1c3)]))this[_0x55b35b(0x205)][_0x55b35b(0x1b7)](_0x639b3a[_0x55b35b(0x1c7)]);if(!this[_0x55b35b(0x1dd)][_0x55b35b(0x1fb)]&&(0x0,drop_exclude_share_1['excludeByReports'])(_0x639b3a,this[_0x55b35b(0x1f8)]))this['unavaliableShares'][_0x55b35b(0x1b7)](_0x639b3a[_0x55b35b(0x1c7)]);if((0x0,drop_exclude_share_1[_0x55b35b(0x1c5)])(_0x639b3a,this[_0x55b35b(0x203)]))this[_0x55b35b(0x205)]['add'](_0x639b3a[_0x55b35b(0x1c7)]);if((0x0,drop_exclude_share_1[_0x55b35b(0x20f)])(_0x639b3a,this[_0x55b35b(0x1f1)]))this['unavaliableShares']['add'](_0x639b3a['ticker']);const _0x50ddcb=moment(),_0x2de9cf=moment()[_0x55b35b(0x1e1)](_0x55b35b(0x1ba))[_0x55b35b(0x1b7)](0x11,_0x55b35b(0x1e2))[_0x55b35b(0x1b7)](0x19,_0x55b35b(0x1d6)),_0x56f062=moment()[_0x55b35b(0x207)](_0x55b35b(0x1ba));_0x50ddcb[_0x55b35b(0x1d8)](_0x2de9cf)&&_0x50ddcb[_0x55b35b(0x1fa)](_0x56f062)&&!this[_0x55b35b(0x1dd)]['includeMS']&&this['unavaliableShares']['add'](_0x639b3a[_0x55b35b(0x1c7)]),_0x50ddcb[_0x55b35b(0x1fa)](_0x2de9cf)&&_0x50ddcb[_0x55b35b(0x1d8)](_0x56f062)&&this['unavaliableShares'][_0x55b35b(0x1b7)](_0x639b3a[_0x55b35b(0x1c7)]);}});}[_0x2ea557(0x1b6)](_0x41043d){const _0x50fc96=_0x2ea557;if(this[_0x50fc96(0x205)][_0x50fc96(0x1d4)](_0x41043d['ticker']))return![];return!![];}[_0x2ea557(0x1ef)](_0x17edde,_0x349e16){const _0x132207=_0x2ea557;var _0x34b3d3;const _0x5392b6=_0x349e16[_0x132207(0x1d0)](_0x1677cc=>_0x1677cc[_0x132207(0x210)]===_0x17edde[_0x132207(0x210)]);if(this[_0x132207(0x1b6)](_0x5392b6)){const {open:_0x26bef7,low:_0x3d14a4}=_0x17edde,_0x547c66=tinkoff_invest_api_1[_0x132207(0x1f3)]['toNumber'](_0x3d14a4),_0x462762=tinkoff_invest_api_1[_0x132207(0x1f3)][_0x132207(0x1dc)](_0x26bef7),_0x14bd51=Array['isArray']((_0x34b3d3=this[_0x132207(0x1dd)])===null||_0x34b3d3===void 0x0?void 0x0:_0x34b3d3[_0x132207(0x20d)])&&this[_0x132207(0x1dd)][_0x132207(0x20d)]['find'](_0x542da0=>_0x542da0[_0x132207(0x210)]===_0x5392b6[_0x132207(0x210)]);_0x5392b6[_0x132207(0x1f4)][_0x132207(0x1e8)](_0x132207(0x211))?_0x462762*((_0x14bd51===null||_0x14bd51===void 0x0?void 0x0:_0x14bd51['diffShares'])||this['options'][_0x132207(0x1f7)])>=_0x547c66&&this[_0x132207(0x1cd)]['next']({'price':this[_0x132207(0x1fe)](_0x547c66,_0x462762-_0x547c66,_0x5392b6,_0x14bd51),'share':_0x5392b6,'money':_0x14bd51===null||_0x14bd51===void 0x0?void 0x0:_0x14bd51[_0x132207(0x1c2)]}):_0x462762*((_0x14bd51===null||_0x14bd51===void 0x0?void 0x0:_0x14bd51[_0x132207(0x1ae)])||this[_0x132207(0x1dd)]['foreignDiffShares'])>=_0x547c66&&_0x547c66>0x5&&this[_0x132207(0x1cd)][_0x132207(0x1f5)]({'price':this['getPrice'](_0x547c66,_0x462762-_0x547c66,_0x5392b6,_0x14bd51),'share':_0x5392b6,'money':_0x14bd51===null||_0x14bd51===void 0x0?void 0x0:_0x14bd51[_0x132207(0x1c2)]});}}['getPrice'](_0x408247,_0x16ea7d,_0x1183c0,_0x3f903c){const _0x161b23=_0x2ea557,_0x48c290=tinkoff_invest_api_1[_0x161b23(0x1f3)][_0x161b23(0x1dc)](_0x1183c0[_0x161b23(0x1b4)]);if(_0x1183c0[_0x161b23(0x1f4)][_0x161b23(0x1e8)]('FORTS_EVENING'))return(0x0,nearest_increment_value_1[_0x161b23(0x1e7)])(_0x408247+_0x16ea7d*((_0x3f903c===null||_0x3f903c===void 0x0?void 0x0:_0x3f903c[_0x161b23(0x1bf)])||this['options'][_0x161b23(0x206)]),_0x48c290);return _0x408247<0x5?(0x0,nearest_increment_value_1[_0x161b23(0x1e7)])(_0x408247+_0x48c290,_0x48c290):(0x0,nearest_increment_value_1[_0x161b23(0x1e7)])(_0x408247+_0x16ea7d*((_0x3f903c===null||_0x3f903c===void 0x0?void 0x0:_0x3f903c[_0x161b23(0x1bf)])||this[_0x161b23(0x1dd)][_0x161b23(0x1aa)]),_0x48c290);}[_0x2ea557(0x1a9)](_0x1be47a){const _0x5c0ebc=_0x2ea557;this[_0x5c0ebc(0x1dd)]=_0x1be47a;const _0x1ef373=perf_hooks_1['performance'][_0x5c0ebc(0x20c)]();this[_0x5c0ebc(0x1c4)][_0x5c0ebc(0x1ee)][_0x5c0ebc(0x1eb)]({'instrumentStatus':instruments_1[_0x5c0ebc(0x202)][_0x5c0ebc(0x1a8)]})[_0x5c0ebc(0x1e3)](_0x36f77a=>{const _0x865b33=_0x5c0ebc,_0x5502fb=perf_hooks_1[_0x865b33(0x1be)]['now']();console['log']('Время\x20запроса\x20futures\x20в\x20reloadOptions:\x20'+(_0x5502fb-_0x1ef373)[_0x865b33(0x1e4)](0x2)+_0x865b33(0x1b2)),console[_0x865b33(0x1d3)](_0x865b33(0x1df),_0x865b33(0x1c8),_0x865b33(0x1d2)),this[_0x865b33(0x1cb)](_0x36f77a[_0x865b33(0x1ee)]);});}}exports[_0x2ea557(0x1ed)]=DropShares;