'use strict';const _0x4d17f0=_0x2fba;(function(_0x124da1,_0x3b61c6){const _0x40abb4=_0x2fba,_0x241afc=_0x124da1();while(!![]){try{const _0x4ae6b7=parseInt(_0x40abb4(0x169))/0x1*(-parseInt(_0x40abb4(0x188))/0x2)+-parseInt(_0x40abb4(0x16e))/0x3+parseInt(_0x40abb4(0x18f))/0x4+-parseInt(_0x40abb4(0x167))/0x5*(-parseInt(_0x40abb4(0x161))/0x6)+-parseInt(_0x40abb4(0x16f))/0x7+-parseInt(_0x40abb4(0x175))/0x8+parseInt(_0x40abb4(0x179))/0x9;if(_0x4ae6b7===_0x3b61c6)break;else _0x241afc['push'](_0x241afc['shift']());}catch(_0x37e017){_0x241afc['push'](_0x241afc['shift']());}}}(_0x568a,0x89ca0));var __asyncValues=this&&this['__asyncValues']||function(_0x5f2d7c){const _0x485745=_0x2fba;if(!Symbol['asyncIterator'])throw new TypeError(_0x485745(0x192));var _0x58aeeb=_0x5f2d7c[Symbol['asyncIterator']],_0x454012;return _0x58aeeb?_0x58aeeb['call'](_0x5f2d7c):(_0x5f2d7c=typeof __values==='function'?__values(_0x5f2d7c):_0x5f2d7c[Symbol['iterator']](),_0x454012={},_0x195b00(_0x485745(0x16d)),_0x195b00(_0x485745(0x16c)),_0x195b00(_0x485745(0x160)),_0x454012[Symbol[_0x485745(0x166)]]=function(){return this;},_0x454012);function _0x195b00(_0x367f67){_0x454012[_0x367f67]=_0x5f2d7c[_0x367f67]&&function(_0x12f0bb){return new Promise(function(_0x1b6ff7,_0x4af748){const _0x409651=_0x2fba;_0x12f0bb=_0x5f2d7c[_0x367f67](_0x12f0bb),_0x106b7f(_0x1b6ff7,_0x4af748,_0x12f0bb[_0x409651(0x17c)],_0x12f0bb[_0x409651(0x174)]);});};}function _0x106b7f(_0x4d42d0,_0x475ee6,_0x2d44cf,_0x53b487){const _0x4eb80e=_0x485745;Promise['resolve'](_0x53b487)[_0x4eb80e(0x178)](function(_0x13b848){_0x4d42d0({'value':_0x13b848,'done':_0x2d44cf});},_0x475ee6);}};Object[_0x4d17f0(0x15f)](exports,_0x4d17f0(0x180),{'value':!![]}),exports[_0x4d17f0(0x186)]=void 0x0;function _0x2fba(_0x4be180,_0x152d4d){const _0x568aea=_0x568a();return _0x2fba=function(_0x2fba8a,_0x16ac18){_0x2fba8a=_0x2fba8a-0x15e;let _0x5e6400=_0x568aea[_0x2fba8a];return _0x5e6400;},_0x2fba(_0x4be180,_0x152d4d);}function _0x568a(){const _0x34e960=['find','rxjs','throw','next','2729814yLnGfM','2505608YvduOv','api','call','futures','length','value','6819976tSxtwx','slice','stream','then','10490553DnkeEz','all','startFuturesDrop','done','nano','InstrumentStatus','market','__esModule','minPriceIncrement','log','createMarketStream','unsubscribes','Helpers','DropFutures','SubscriptionInterval','6jshtBh','../utils/nearest-increment-value','moexDiffFutureBuy','error','options','units','candles','3982476sRmhiZ','close','SUBSCRIPTION_INTERVAL_ONE_MINUTE','Symbol.asyncIterator\x20is\x20not\x20defined.','Subject','moexDiffFuture','getPrice','filter','INSTRUMENT_STATUS_BASE','map','halt','instruments','tap','push','toNumber','tinkoff-invest-api/cjs/generated/marketdata','defineProperty','return','2576610tqGaQT','buy','buyTheDrop','stop','stream\x20error','asyncIterator','10JUAAMl','figi','111781YIIFOk'];_0x568a=function(){return _0x34e960;};return _0x568a();}const rxjs_1=require(_0x4d17f0(0x16b)),tinkoff_invest_api_1=require('tinkoff-invest-api'),instruments_1=require('tinkoff-invest-api/cjs/generated/instruments'),marketdata_1=require(_0x4d17f0(0x15e)),nearest_increment_value_1=require(_0x4d17f0(0x189)),CHANK_SIZE=0x12c;class DropFutures{constructor(_0x3ebc77,_0x51b5cf){const _0x12873a=_0x4d17f0;this[_0x12873a(0x170)]=_0x3ebc77,this[_0x12873a(0x18c)]=_0x51b5cf,this[_0x12873a(0x163)]=new rxjs_1[(_0x12873a(0x193))](),this[_0x12873a(0x184)]=[],this[_0x12873a(0x162)]=this[_0x12873a(0x163)]['pipe']((0x0,rxjs_1[_0x12873a(0x196)])(()=>!this[_0x12873a(0x199)]),(0x0,rxjs_1[_0x12873a(0x19b)])(()=>{const _0x10a56e=_0x12873a;!this[_0x10a56e(0x199)]&&(this[_0x10a56e(0x199)]=!![],setTimeout(()=>this[_0x10a56e(0x199)]=![],this[_0x10a56e(0x18c)]['haltTimeout']));}));}async[_0x4d17f0(0x17b)](){const _0x20e8b1=_0x4d17f0;var _0x582df0,_0xab3b0e,_0x56151b,_0x5a63e4;const _0x55bc6d=await this[_0x20e8b1(0x170)][_0x20e8b1(0x19a)][_0x20e8b1(0x172)]({'instrumentStatus':instruments_1[_0x20e8b1(0x17e)][_0x20e8b1(0x197)]}),_0x12f62b=[];for(let _0x22376b=0x0;_0x22376b<_0x55bc6d[_0x20e8b1(0x19a)][_0x20e8b1(0x173)];_0x22376b+=CHANK_SIZE){_0x12f62b[_0x20e8b1(0x19c)](_0x55bc6d['instruments'][_0x20e8b1(0x176)](_0x22376b,_0x22376b+CHANK_SIZE));}try{for(var _0x50e04c=!![],_0x10a553=__asyncValues(_0x12f62b),_0x30d0f0;_0x30d0f0=await _0x10a553[_0x20e8b1(0x16d)](),_0x582df0=_0x30d0f0[_0x20e8b1(0x17c)],!_0x582df0;){_0x5a63e4=_0x30d0f0['value'],_0x50e04c=![];try{const _0x7571df=_0x5a63e4,_0x18c2a4=await this[_0x20e8b1(0x170)][_0x20e8b1(0x183)]()[_0x20e8b1(0x18e)]({'instruments':_0x7571df[_0x20e8b1(0x198)](_0x4e79cd=>({'figi':_0x4e79cd[_0x20e8b1(0x168)],'interval':marketdata_1[_0x20e8b1(0x187)][_0x20e8b1(0x191)]})),'waitingClose':![]},_0x53cebb=>this['processOnCandle'](_0x53cebb,_0x7571df));this[_0x20e8b1(0x184)]['push'](_0x18c2a4),this[_0x20e8b1(0x170)][_0x20e8b1(0x177)]['market']['on']('error',_0x2e50b3=>console['log'](_0x20e8b1(0x165),_0x2e50b3)),this[_0x20e8b1(0x170)][_0x20e8b1(0x177)][_0x20e8b1(0x17f)]['on'](_0x20e8b1(0x190),_0x113319=>console[_0x20e8b1(0x182)]('stream\x20closed,\x20reason:',_0x113319));}finally{_0x50e04c=!![];}}}catch(_0xafa0d6){_0xab3b0e={'error':_0xafa0d6};}finally{try{if(!_0x50e04c&&!_0x582df0&&(_0x56151b=_0x10a553[_0x20e8b1(0x160)]))await _0x56151b[_0x20e8b1(0x171)](_0x10a553);}finally{if(_0xab3b0e)throw _0xab3b0e[_0x20e8b1(0x18b)];}}return this[_0x20e8b1(0x162)];}['processOnCandle'](_0x2a9abe,_0x16ad9a){const _0x1d769c=_0x4d17f0,{open:_0x3e2564,low:_0x534cb7}=_0x2a9abe,_0x5a3dd6=_0x16ad9a[_0x1d769c(0x16a)](_0x36fd03=>_0x36fd03['figi']===_0x2a9abe['figi']),_0x113da3=Number(_0x534cb7[_0x1d769c(0x18d)]+'.'+_0x534cb7[_0x1d769c(0x17d)]),_0x5a8780=Number(_0x3e2564['units']+'.'+_0x3e2564['nano']);_0x5a8780*this[_0x1d769c(0x18c)][_0x1d769c(0x194)]>_0x113da3&&this[_0x1d769c(0x163)][_0x1d769c(0x16d)]({'price':this[_0x1d769c(0x195)](_0x113da3,_0x5a8780-_0x113da3,_0x5a3dd6),'future':_0x5a3dd6});}['getPrice'](_0x14bd12,_0x4ee374,_0x2028a2){const _0x3aa5e7=_0x4d17f0;return(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x14bd12+_0x4ee374*this[_0x3aa5e7(0x18c)][_0x3aa5e7(0x18a)],tinkoff_invest_api_1[_0x3aa5e7(0x185)][_0x3aa5e7(0x19d)](_0x2028a2[_0x3aa5e7(0x181)]));}[_0x4d17f0(0x164)](){const _0x2402ac=_0x4d17f0;Promise[_0x2402ac(0x17a)](this[_0x2402ac(0x184)])['then']();}}exports['DropFutures']=DropFutures;